
ADRL R0, font_32
l3
BL printc
ADD R0, R0, #7
B l3
SVC 2

printc ;takes parameter R0 <- address of character
PUSH {R1 - R13}
;R0 byte address
MOV R1, #0 ; cursorposx
MOV R2, #0 ; cursorposy
MOV R3, #0 ; byte counter
MOV R4, #0 ; bit counter
MOV R5, #0 ; font data
MOV R6, #0 ; mask addr
MOV R7, #0 ; mask data
MOV R8, #0 ; base address
MOV R9, #0 ;
MOV R10, #0 ;
MOV R11, #0
MOV R12, #0
MOV R13, #0
;----------


LDR         R1, cursorposx
LDR         R2, cursorposy
MOV         R3, #0
MOV         R4, #-1
ADRL        R6, bmask0
; Corrects cursors for newline if needed
CMP         R1, #40
SUBGE       R1, R1, #40
ADDGE       R2, R2, #1
;calculates base address to draw from
LDR         R8, LCD_linediff
MUL         R8, R8, R2
LDR         R9, charwidth
MUL         R9, R9, R1
ADD         R8, R8, R9
LDR         R9, addr_LCD
ADD         R8, R8, R9        ;base now in R8, R9 free
;----
;handles incrememts of byte and bit
next
CMP         R4, #7
MOVEQ       R4, #0
ADDEQ       R3, R3, #1
ADDNE       R4, R4, #1
CMP         R3, #7
BEQ         POSTEND




;
LDRB        R5, [R0, R3] ;loads the font byte
LDRB        R7, [R6, R4] ;loads the mask
AND         R5, R7, R5 ; check the bit

MOV         R9, #3
MUL         R9, R9, R3
LDR         R10, LCD_width
MUL         R10, R10, R4
ADD         R9, R9, R10
ADD         R9, R9, R8      ;address to write in R9

CMP         R5, R7
BEQ high
BNE low

high
LDRB R10, WHITE
STRB R10, [R9], #1
STRB R10, [R9], #1
STRB R10, [R9]
B next

low
LDRB R10, BLACK
STRB R10, [R9], #1
STRB R10, [R9], #1
STRB R10, [R9]
B next

POSTEND
MOV   R10, #3
MUL   R9, R10, R3
LDR   R10, LCD_width
MUL   R10, R10, R4
ADD   R9, R9, R10
LDR   R10, addr_LCD
ADD   R9, R9, R10
LDR   R11, charwidth
MUL   R10, R1, R11
ADD   R9, R10, R9
LDR   R11, LCD_linediff
MUL   R10, R2, R11
ADD   R9, R10, R9

LDRB  R10, BLACK
STRB  R10, [R9], #1
STRB  R10, [R9], #1
STRB  R10, [R9]
ADD   R4, R4, #1
CMP   R4, #8
BNE POSTEND


ADD   R1, R1, #1
ADRL  R12, cursorposx
STR   R1, [R12]
ADRL  R12, cursorposy
STR   R2, [R12]




POP {R1 - R13}
MOV PC, LR












;---------------------------------------
align
bmask0      DEFB &01
bmask1      DEFB &02
bmask2      DEFB &04
bmask3      DEFB &08
bmask4      DEFB &10
bmask5      DEFB &20
bmask6      DEFB &40
bmask7      DEFB &80

cursorposx      DEFW 0
cursorposy      DEFW 0

addr_LCD        DEFW 0xAC00_0000
addr_LCD_end    DEFW 0xAC03_83FF
LCD_width       DEFW 960
charwidth       DEFW 24
LCD_linediff    DEFW 7680
WHITE           EQU     &00
BLACK           EQU     &FF
FONT_WIDTH      EQU     7
FONT_HEIGHT     EQU     8


font_32 defb 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
font_33 defb 0x5f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
font_34 defb 0x03, 0x00, 0x03, 0x00, 0x00, 0x00, 0x00
font_35 defb 0x14, 0x7f, 0x14, 0x7f, 0x14, 0x00, 0x00
font_36 defb 0x6f, 0x49, 0xc9, 0x7b, 0x00, 0x00, 0x00
font_37 defb 0x63, 0x13, 0x08, 0x64, 0x63, 0x00, 0x00
font_38 defb 0x7f, 0xc9, 0x49, 0x63, 0x00, 0x00, 0x00
font_39 defb 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
font_40 defb 0x3e, 0x41, 0x00, 0x00, 0x00, 0x00, 0x00
font_41 defb 0x41, 0x3e, 0x00, 0x00, 0x00, 0x00, 0x00
font_42 defb 0x0a, 0x04, 0x1f, 0x04, 0x0a, 0x00, 0x00
font_43 defb 0x08, 0x08, 0x3e, 0x08, 0x08, 0x00, 0x00
font_44 defb 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
font_45 defb 0x08, 0x08, 0x08, 0x08, 0x00, 0x00, 0x00
font_46 defb 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
font_47 defb 0x60, 0x10, 0x08, 0x04, 0x03, 0x00, 0x00
font_48 defb 0x7f, 0x41, 0x41, 0x7f, 0x00, 0x00, 0x00
font_49 defb 0x01, 0x7f, 0x00, 0x00, 0x00, 0x00, 0x00
font_50 defb 0x7b, 0x49, 0x49, 0x6f, 0x00, 0x00, 0x00
font_51 defb 0x63, 0x49, 0x49, 0x7f, 0x00, 0x00, 0x00
font_52 defb 0x0f, 0x08, 0x08, 0x7f, 0x00, 0x00, 0x00
font_53 defb 0x6f, 0x49, 0x49, 0x7b, 0x00, 0x00, 0x00
font_54 defb 0x7f, 0x49, 0x49, 0x7b, 0x00, 0x00, 0x00
font_55 defb 0x03, 0x01, 0x01, 0x7f, 0x00, 0x00, 0x00
font_56 defb 0x7f, 0x49, 0x49, 0x7f, 0x00, 0x00, 0x00
font_57 defb 0x0f, 0x09, 0x09, 0x7f, 0x00, 0x00, 0x00
font_58 defb 0x41, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
font_59 defb 0xc1, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
font_60 defb 0x08, 0x14, 0x22, 0x00, 0x00, 0x00, 0x00
font_61 defb 0x14, 0x14, 0x14, 0x14, 0x00, 0x00, 0x00
font_62 defb 0x22, 0x14, 0x08, 0x00, 0x00, 0x00, 0x00
font_63 defb 0x03, 0x59, 0x09, 0x0f, 0x00, 0x00, 0x00
font_64 defb 0x7f, 0x41, 0x5d, 0x55, 0x5f, 0x00, 0x00
font_65 defb 0x7f, 0x09, 0x09, 0x7f, 0x00, 0x00, 0x00
font_66 defb 0x7f, 0x49, 0x49, 0x77, 0x00, 0x00, 0x00
font_67 defb 0x7f, 0x41, 0x41, 0x63, 0x00, 0x00, 0x00
font_68 defb 0x7f, 0x41, 0x41, 0x3e, 0x00, 0x00, 0x00
font_69 defb 0x7f, 0x49, 0x49, 0x63, 0x00, 0x00, 0x00
font_70 defb 0x7f, 0x09, 0x09, 0x03, 0x00, 0x00, 0x00
font_71 defb 0x7f, 0x41, 0x49, 0x7b, 0x00, 0x00, 0x00
font_72 defb 0x7f, 0x08, 0x08, 0x7f, 0x00, 0x00, 0x00
font_73 defb 0x41, 0x7f, 0x41, 0x00, 0x00, 0x00, 0x00
font_74 defb 0x60, 0x40, 0x40, 0x7f, 0x00, 0x00, 0x00
font_75 defb 0x7f, 0x08, 0x08, 0x77, 0x00, 0x00, 0x00
font_76 defb 0x7f, 0x40, 0x40, 0x60, 0x00, 0x00, 0x00
font_77 defb 0x7f, 0x01, 0x01, 0x7f, 0x01, 0x01, 0x7f
font_78 defb 0x7f, 0x01, 0x01, 0x7f, 0x00, 0x00, 0x00
font_79 defb 0x7f, 0x41, 0x41, 0x7f, 0x00, 0x00, 0x00
font_80 defb 0x7f, 0x09, 0x09, 0x0f, 0x00, 0x00, 0x00
font_81 defb 0x7f, 0x41, 0xc1, 0x7f, 0x00, 0x00, 0x00
font_82 defb 0x7f, 0x09, 0x09, 0x77, 0x00, 0x00, 0x00
font_83 defb 0x6f, 0x49, 0x49, 0x7b, 0x00, 0x00, 0x00
font_84 defb 0x01, 0x01, 0x7f, 0x01, 0x01, 0x00, 0x00
font_85 defb 0x7f, 0x40, 0x40, 0x7f, 0x00, 0x00, 0x00
font_86 defb 0x7f, 0x20, 0x10, 0x0f, 0x00, 0x00, 0x00
font_87 defb 0x7f, 0x40, 0x40, 0x7f, 0x40, 0x40, 0x7f
font_88 defb 0x77, 0x08, 0x08, 0x77, 0x00, 0x00, 0x00
font_89 defb 0x6f, 0x48, 0x48, 0x7f, 0x00, 0x00, 0x00
font_90 defb 0x71, 0x49, 0x49, 0x47, 0x00, 0x00, 0x00
font_91 defb 0x7f, 0x41, 0x00, 0x00, 0x00, 0x00, 0x00
font_92 defb 0x03, 0x04, 0x08, 0x10, 0x60, 0x00, 0x00
font_93 defb 0x41, 0x7f, 0x00, 0x00, 0x00, 0x00, 0x00
font_94 defb 0x04, 0x02, 0x01, 0x02, 0x04, 0x00, 0x00
font_95 defb 0x80, 0x80, 0x80, 0x80, 0x00, 0x00, 0x00
font_96 defb 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
font_97 defb 0x74, 0x54, 0x54, 0x7c, 0x00, 0x00, 0x00
font_98 defb 0x7f, 0x44, 0x44, 0x7c, 0x00, 0x00, 0x00
font_99 defb 0x7c, 0x44, 0x44, 0x6c, 0x00, 0x00, 0x00
font_100 defb 0x7c, 0x44, 0x44, 0x7f, 0x00, 0x00, 0x00
font_101 defb 0x7c, 0x54, 0x54, 0x5c, 0x00, 0x00, 0x00
font_102 defb 0x7f, 0x05, 0x05, 0x01, 0x00, 0x00, 0x00
font_103 defb 0xbc, 0xa4, 0xa4, 0xfc, 0x00, 0x00, 0x00
font_104 defb 0x7f, 0x04, 0x04, 0x7c, 0x00, 0x00, 0x00
font_105 defb 0x7d, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
font_106 defb 0x80, 0xfd, 0x00, 0x00, 0x00, 0x00, 0x00
font_107 defb 0x7f, 0x04, 0x04, 0x7a, 0x00, 0x00, 0x00
font_108 defb 0x7f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
font_109 defb 0x7c, 0x04, 0x04, 0x7c, 0x04, 0x04, 0x7c
font_110 defb 0x7c, 0x04, 0x04, 0x7c, 0x00, 0x00, 0x00
font_111 defb 0x7c, 0x44, 0x44, 0x7c, 0x00, 0x00, 0x00
font_112 defb 0xfc, 0x44, 0x44, 0x7c, 0x00, 0x00, 0x00
font_113 defb 0x7c, 0x44, 0x44, 0xfc, 0x00, 0x00, 0x00
font_114 defb 0x7c, 0x04, 0x04, 0x0c, 0x00, 0x00, 0x00
font_115 defb 0x5c, 0x54, 0x54, 0x74, 0x00, 0x00, 0x00
font_116 defb 0x7f, 0x44, 0x44, 0x60, 0x00, 0x00, 0x00
font_117 defb 0x7c, 0x40, 0x40, 0x7c, 0x00, 0x00, 0x00
font_118 defb 0x7c, 0x20, 0x10, 0x0c, 0x00, 0x00, 0x00
font_119 defb 0x7c, 0x40, 0x40, 0x7c, 0x40, 0x40, 0x7c
font_120 defb 0x6c, 0x10, 0x10, 0x6c, 0x00, 0x00, 0x00
font_121 defb 0xbc, 0xa0, 0xa0, 0xfc, 0x00, 0x00, 0x00
font_122 defb 0x64, 0x54, 0x54, 0x4c, 0x00, 0x00, 0x00
font_123 defb 0x08, 0x3e, 0x41, 0x00, 0x00, 0x00, 0x00
font_124 defb 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
font_125 defb 0x41, 0x3e, 0x08, 0x00, 0x00, 0x00, 0x00
font_126 defb 0x1c, 0x04, 0x1c, 0x10, 0x1c, 0x00, 0x00
align
